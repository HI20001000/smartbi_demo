{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://smartbi-demo/contracts/semantic_plan.schema.json",
  "title": "SemanticPlan",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "plan_version",
    "request_id",
    "metric_id",
    "filters",
    "group_by",
    "measures",
    "time_window",
    "assumptions",
    "needs_clarification",
    "clarification_question"
  ],
  "properties": {
    "plan_version": {"type": "string", "const": "1.0"},
    "request_id": {"type": "string", "minLength": 1},
    "metric_id": {"type": "string", "minLength": 1},
    "filters": {
      "type": "object",
      "additionalProperties": {"type": ["string", "number", "boolean"]}
    },
    "group_by": {
      "type": "array",
      "items": {"type": "string"}
    },
    "measures": {
      "type": "array",
      "items": {"type": "string"},
      "minItems": 1
    },
    "time_window": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "start_date", "end_date"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["single_date", "date_range", "month_to_date", "year_to_date", "latest_available_date"]
        },
        "start_date": {"type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$"},
        "end_date": {"type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$"}
      }
    },
    "assumptions": {
      "type": "array",
      "items": {"type": "string"}
    },
    "confidence": {"type": "number", "minimum": 0, "maximum": 1},
    "needs_clarification": {"type": "boolean"},
    "clarification_question": {"type": ["string", "null"]}
  }
}
